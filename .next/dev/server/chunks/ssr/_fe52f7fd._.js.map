{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/vilmerfrost/frost-demo/app/projects/%5Bid%5D/actions.ts"],"sourcesContent":["'use server'\n\nimport { redirect } from 'next/navigation'\nimport { createClient } from '../../utils/supabase/server'\n\nexport async function createLockedInvoice(projectId: string) {\n  const supabase = createClient()\n\n  // Kör RPC som din inloggade användare; funkar om RLS/tenant stämmer.\n  const { data, error } = await supabase\n    .rpc('create_invoice_from_project', { p_project_id: projectId, p_due_days: 30 })\n\n  if (error) {\n    console.error('create_invoice_from_project error', error)\n    throw new Error(error.message)\n  }\n\n  // Skicka användaren till den låsta fakturan\n  redirect(`/invoices/${data}`)\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;;;;;AAEO,eAAe,oBAAoB,SAAiB;IACzD,MAAM,WAAW,IAAA,kJAAY;IAE7B,qEAAqE;IACrE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,GAAG,CAAC,+BAA+B;QAAE,cAAc;QAAW,YAAY;IAAG;IAEhF,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO;IAC/B;IAEA,4CAA4C;IAC5C,IAAA,iMAAQ,EAAC,CAAC,UAAU,EAAE,MAAM;AAC9B;;;IAdsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Users/vilmerfrost/frost-demo/app/projects/%5Bid%5D/page.tsx"],"sourcesContent":["// app/projects/[id]/page.tsx\nimport { createClient } from '@/utils/supabase/server'\nimport { createLockedInvoice } from './actions'\nimport Link from 'next/link'\n\nfunction sek(n: number) {\n  try {\n    return Number(n ?? 0).toLocaleString('sv-SE', { style: 'currency', currency: 'SEK' })\n  } catch {\n    return `${Math.round(Number(n ?? 0))} kr`\n  }\n}\n\nexport default async function ProjectDetailPage({ params }: { params: { id: string } }) {\n  const supabase = createClient()\n\n  // Auth guard\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return (\n      <div className=\"mx-auto max-w-xl p-8\">\n        Du är inte inloggad. <a className=\"underline\" href=\"/login\">Logga in</a>\n      </div>\n    )\n  }\n\n  // Hämta projekt\n  const { data: project, error: projErr } = await supabase\n    .from('projects')\n    .select('*')\n    .eq('id', params.id)\n    .single()\n\n  if (projErr || !project) {\n    return <div className=\"mx-auto max-w-xl p-8\">Kunde inte hämta projekt.</div>\n  }\n\n  // (Valfritt) hämta kund\n  const clientId = project.client_id\n  const { data: client } = clientId\n    ? await supabase.from('clients').select('*').eq('id', clientId).single()\n    : { data: null as any }\n\n  // Hämta senaste låsta fakturan (om du har created_at eller issue_date)\n  const { data: lastInv } = await supabase\n    .from('invoices')\n    .select('id, number, status, issue_date')\n    .eq('project_id', project.id)\n    .order('issue_date', { ascending: false })\n    .limit(1)\n    .maybeSingle()\n\n  return (\n    <div className=\"mx-auto max-w-3xl p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-start justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold\">{project.name}</h1>\n          {client && (\n            <div className=\"text-sm text-gray-600\">\n              {client.name}{client.email ? ` • ${client.email}` : ''}\n            </div>\n          )}\n          {project.base_rate_sek ? (\n            <div className=\"text-sm text-gray-700 mt-1\">Grundpris: {sek(project.base_rate_sek)} / tim</div>\n          ) : null}\n        </div>\n\n        <Link\n          href=\"/projects\"\n          className=\"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 text-gray-800\"\n        >\n          Projekt\n        </Link>\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex flex-wrap gap-3\">\n        {/* Skapa & lås (snapshot) → redirect till /invoices/:id */}\n        <form action={async () => { 'use server'; await createLockedInvoice(params.id) }}>\n          <button\n            type=\"submit\"\n            className=\"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg\"\n          >\n            Skapa & lås faktura\n          </button>\n        </form>\n\n        {/* Visa live-faktura (läser från vy/v_invoice_lines) */}\n        <Link\n          href={`/projects/${params.id}/invoice`}\n          className=\"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50\"\n        >\n          Visa \"live\" faktura\n        </Link>\n\n        {/* Visa senaste låsta faktura (om finns) */}\n        {lastInv ? (\n          <Link\n            href={`/invoices/${lastInv.id}`}\n            className=\"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50\"\n          >\n            Visa senast låsta faktura{lastInv.number ? ` (${lastInv.number})` : ''}\n          </Link>\n        ) : null}\n      </div>\n\n      {/* (Valfritt) lite status/info */}\n      <div className=\"rounded-xl border bg-white p-5\">\n        <h2 className=\"font-semibold text-gray-900 mb-3\">Projektinfo</h2>\n        <div className=\"text-sm leading-6 text-gray-700\">\n          <div>Namn: <span className=\"font-medium text-gray-900\">{project.name}</span></div>\n          {project.status && <div>Status: <span className=\"font-medium\">{project.status}</span></div>}\n          {project.budgeted_hours != null && (\n            <div>Budget timmar: <span className=\"font-medium\">{project.budgeted_hours}</span></div>\n          )}\n          {project.budgeted_cost_sek != null && (\n            <div>Budget kostnad: <span className=\"font-medium\">{sek(project.budgeted_cost_sek)}</span></div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 330, "column": 0}, "map": {"version":3,"sources":["file:///Users/vilmerfrost/frost-demo/.next-internal/server/app/projects/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {signOut as '0037d1b4c6fcb424e7c16062aeabd7cee739ff8680'} from 'ACTIONS_MODULE0'\nexport {sendMagicLink as '40c061ff68462f6d9579e14509518067fbcf3ba35a'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_ACTION_0 as '40a46afd51863bdb9ab06ac1d7409bb442828e59e4'} from 'ACTIONS_MODULE1'\nexport {createLockedInvoice as '400671894bd1cd4ce536d32f4e679b8a1a587cfdcc'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AAEA;AACA","debugId":null}}]
}
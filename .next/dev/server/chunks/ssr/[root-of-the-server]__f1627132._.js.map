{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/vilmerfrost/frost-demo/app/page.tsx"],"sourcesContent":["// app/projects/page.tsx\nimport { createClient } from '@/utils/supabase/server'\nimport Link from 'next/link'\n\nfunction sek(n: number) {\n  try { return Number(n ?? 0).toLocaleString('sv-SE', { style: 'currency', currency: 'SEK' }) }\n  catch { return `${Math.round(Number(n ?? 0))} kr` }\n}\n\nexport default async function ProjectsPage() {\n  const supabase = createClient()\n  const { data: authData } = await supabase.auth.getUser()\n  const user = authData?.user\n  if (!user) {\n    return (\n      <div className=\"mx-auto max-w-xl p-8\">\n        Du är inte inloggad. <a className=\"underline\" href=\"/login\">Logga in</a>\n      </div>\n    )\n  }\n\n  const claims: any = user.app_metadata ?? user.user_metadata ?? {}\n  const tenantId: string | undefined = claims.tenant_id\n  if (!tenantId) {\n    return <div className=\"mx-auto max-w-xl p-8\">Saknar tenant_id på användaren.</div>\n  }\n\n  // Hämta projekt\n  const { data: projectsData, error: projectsErr } = await supabase\n    .from('projects')\n    .select('id, name, base_rate_sek')\n    .eq('tenant_id', tenantId)\n    .order('created_at', { ascending: false })\n  if (projectsErr) {\n    return <div className=\"mx-auto max-w-xl p-8\">Kunde inte hämta projekt.</div>\n  }\n  const projects = projectsData ?? []\n\n  // Hämta ofakturerat per projekt (group by project_id)\n  const { data: unbilledData } = await supabase\n    .from('time_entries')\n    .select('project_id, amount_sek')\n    .eq('tenant_id', tenantId)\n    .is('invoice_id', null)\n\n  // gruppera\n  const unbilledByProject = new Map<string, number>()\n  for (const row of (unbilledData ?? [])) {\n    const pid = row.project_id as string\n    const amt = Number(row.amount_sek ?? 0)\n    unbilledByProject.set(pid, (unbilledByProject.get(pid) ?? 0) + amt)\n  }\n\n  return (\n    <div className=\"mx-auto max-w-3xl p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-2xl sm:text-3xl font-bold\">Projekt</h1>\n        <div className=\"flex gap-2\">\n          <Link href=\"/admin\" className=\"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50\">Admin</Link>\n          <Link href=\"/tid/ny\" className=\"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white\">Logga tid</Link>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-3\">\n        {projects.length === 0 && (\n          <div className=\"rounded-xl border bg-white p-5 text-gray-500 italic\">Inga projekt.</div>\n        )}\n\n        {projects.map((p: any) => {\n          const unbilled = unbilledByProject.get(p.id) ?? 0\n          const statusBadge = p.status === 'Pågående'\n            ? <span className=\"px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">Pågående</span>\n            : p.status === 'Fakturerat'\n            ? <span className=\"px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">Fakturerat</span>\n            : <span className=\"px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700\">{p.status ?? 'Okänd'}</span>\n\n          return (\n            <Link\n              key={p.id}\n              href={`/projects/${p.id}`}\n              className=\"rounded-xl border bg-white p-5 hover:bg-gray-50 transition flex items-center justify-between\"\n            >\n              <div>\n                <div className=\"flex items-center gap-3\">\n                  <h3 className=\"text-lg font-semibold\">{p.name}</h3>\n                  {statusBadge}\n                </div>\n                <div className=\"text-sm text-gray-600\">\n                  Timpris (baseline): {p.base_rate_sek ? sek(p.base_rate_sek) : '–'}\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-xs text-gray-500\">Ofakturerat</div>\n                <div className=\"text-base font-semibold\">{sek(unbilled)}</div>\n              </div>\n            </Link>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}